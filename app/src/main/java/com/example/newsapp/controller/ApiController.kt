package com.example.newsapp.controller

import java.io.BufferedReader
import java.io.IOException
import java.io.InputStream
import java.io.InputStreamReader
import java.net.HttpURLConnection
import java.net.URL


class ApiController {

    val TIMEOUT_MILLIS = 0

    interface ICallback {
        fun callback(result: String)
    }

    fun get(listener: ICallback, endpoint: String, headers: Map<String, String>, params: Map<String, String>?) {

        val sb: StringBuffer = StringBuffer("")
        var httpConn: HttpURLConnection? = null
        var br: BufferedReader? = null
        var `is`: InputStream? = null
        var isr: InputStreamReader? = null

        try {
            val url = URL(endpoint)
            httpConn = url.openConnection() as HttpURLConnection
            httpConn.connectTimeout = TIMEOUT_MILLIS // 接続にかかる時間
            httpConn.readTimeout = TIMEOUT_MILLIS // データの読み込みにかかる時間
            httpConn.requestMethod = "GET" // HTTPメソッド
            httpConn.useCaches = false // キャッシュ利用
            httpConn.doOutput = false // リクエストのボディの送信を許可(GETのときはfalse,POSTのときはtrueにする)
            httpConn.doInput = true // レスポンスのボディの受信を許可

            httpConn.connect()

            val responseCode = httpConn.responseCode

            if (responseCode == HttpURLConnection.HTTP_OK) {
                `is` = httpConn.inputStream
                isr = InputStreamReader(`is`, "UTF-8")
                br = BufferedReader(isr)
                var line: String? = null
                while (br.readLine().also { line = it } != null) {
                    sb.append(line)
                }
            } else {
                // TODO: OKじゃない時のことを考える
                // TODO: 結果をどこまで戻してどこで判定するか？
                // 403
                // 500
            }
        } catch (e: IOException) {
            throw e
        } finally {
//            Callback.callback(sb.toString())

            val response = "{\"status\":\"ok\",\"totalResults\":29,\"articles\":[{\"source\":{\"id\":null,\"name\":\"Prtimes.jp\"},\"author\":null,\"title\":\"時間の移ろいを感じるグラデーションの空をテーマにしたお香の開発プロジェクト - PR TIMES\",\"description\":\"合同会社風狂のプレスリリース（2024年5月18日 15時29分）時間の移ろいを感じるグラデーションの空をテーマにしたお香の開発プロジェクト\",\"url\":\"https://prtimes.jp/main/html/rd/p/000000006.000120453.html\",\"urlToImage\":\"https://prcdn.freetls.fastly.net/release_image/120453/6/120453-6-48d89cb114ce3b4ff194639c65273c14-3900x2600.jpg?format=jpeg&auto=webp&fit=bounds&width=2400&height=1260\",\"publishedAt\":\"2024-05-18T06:29:47Z\",\"content\":\"Copyright © PR TIMES Corporation All Rights Reserved.\"},{\"source\":{\"id\":null,\"name\":\"Oricon.co.jp\"},\"author\":\"ORICON NEWS\",\"title\":\"石原さとみ、迷子見つかり号泣「怖かった」 子どもが失踪する母役「1年以上生き続けている」 - ORICON NEWS\",\"description\":\"俳優の 石原さとみ （37）が18日、都内で行われた映画『ミッシング』公開記念舞台あいさつに登壇。子どもが疾走する母・沙織里を演じた石原は、プライベートで迷子に遭遇したことを明かした。  　石原は先日、家族と大きな公園でピクニックをしていたところ、迷子のお知らせがあったそう。「見わたしたら叫んでいるお母さんがいて、この人がお母さんだとわかりました。本当に鬼気迫る表情と声に胸が引き締められました」と当時の心境を告白。40分近くにわたって石原も迷子を捜したそうで「ずっと怖かったんです」と振り返った。\",\"url\":\"https://www.oricon.co.jp/news/2327518/full/\",\"urlToImage\":\"https://contents.oricon.co.jp/upimg/news/2328000/2327518/20240518_151834_o_25824133.jpg\",\"publishedAt\":\"2024-05-18T05:43:00Z\",\"content\":\"ORICON NEWSoricon MENewSWebPCJASRAC9009642142Y31015 / 9009642140Y38026 | NexToneID000000579\\r\\nCookie\"},{\"source\":{\"id\":null,\"name\":\"Nhk.or.jp\"},\"author\":null,\"title\":\"つばさの党 演説妨害5件以上 選挙カー追い回し10件以上確認 | NHK - nhk.or.jp\",\"description\":\"先月行われた衆議院東京15区の補欠選挙で、政治団体「つばさの党」の代表ら3人が、ほかの陣営の演説を妨害したとして逮捕され…\",\"url\":\"https://www3.nhk.or.jp/news/html/20240518/k10014453371000.html\",\"urlToImage\":\"https://www3.nhk.or.jp/news/html/20240518/K10014453371_2405181339_0518143323_01_02.jpg\",\"publishedAt\":\"2024-05-18T05:34:19Z\",\"content\":\"\"},{\"source\":{\"id\":null,\"name\":\"Nhk.or.jp\"},\"author\":null,\"title\":\"ドジャース 大谷翔平 13号ツーランHR リーグ単独トップに | NHK - nhk.or.jp\",\"description\":\"大リーグ、ドジャースの大谷翔平選手が本拠地のあるロサンゼルス市が「大谷翔平の日」に制定した5月17日に行われたレッズ戦で…\",\"url\":\"https://www3.nhk.or.jp/news/html/20240518/k10014453251000.html\",\"urlToImage\":\"https://www3.nhk.or.jp/news/html/20240518/K10014453251_2405181244_0518124609_01_02.jpg\",\"publishedAt\":\"2024-05-18T04:18:17Z\",\"content\":\"51713\\r\\n517 \\r\\n13HR \\r\\n5172\\r\\n113\\r\\n321150313\\r\\n13HR\\r\\n5\\r\\nLA\"},{\"source\":{\"id\":null,\"name\":\"Hochi.news\"},\"author\":\"報知新聞社\",\"title\":\"ロコ・ソラーレ吉田夕梨花、スピードスケート日本代表・新濱立也との結婚を発表「良い時も苦しい時も２人で力を合わせて」 - スポーツ報知\",\"description\":\"北京五輪で銀メダルを獲得したカーリング女子「ロコ・ソラーレ」の吉田夕梨花（３０）が１８日に自身のインスタグラムを更新し、スピードスケート日本代表の新濱立也（しんはま・たつや、２７）と結婚したことを発\",\"url\":\"https://hochi.news/articles/20240518-OHT1T51101.html\",\"urlToImage\":\"https://hochi.news/images/2024/05/18/20240518-OHT1I51142-L.jpg\",\"publishedAt\":\"2024-05-18T04:04:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Hochi.news\"},\"author\":\"報知新聞社\",\"title\":\"ＮＨＫ大河「光る君へ」伊周＆隆家の「長徳の変」で窮地に立つ定子 まひろの行動の意図は…第２０回みどころ - スポーツ報知\",\"description\":\"女優の吉高由里子が主演するＮＨＫ大河ドラマ「光る君へ」（日曜・後８時）の第２０回「望みの先に」が１９日に放送される。\",\"url\":\"https://hochi.news/articles/20240518-OHT1T51078.html\",\"urlToImage\":\"https://hochi.news/images/2024/05/18/20240518-OHT1I51124-L.jpg\",\"publishedAt\":\"2024-05-18T04:00:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Nikkansports.com\"},\"author\":\"日刊スポーツ\",\"title\":\"専大松戸－東海大相模、武相－昌平、白鴎大足利－前橋商ほか／関東大会速報中 - 高校野球 - ニッカンスポーツ\",\"description\":\"春季関東大会が開幕。第1日は1回戦1試合と2回戦4試合の計5試合。専大松戸（千葉1位）は東海大相模（神奈川2位）と、武相（神奈川1位）は昌平（埼玉2位）と対戦… - 日刊スポーツ新聞社のニュースサイト、ニッカンスポーツ・コム（nikkansports.com）。\",\"url\":\"https://www.nikkansports.com/baseball/highschool/news/202405170001868.html\",\"urlToImage\":\"https://www.nikkansports.com/baseball/highschool/news/img/202405170001868-w500_0.jpg\",\"publishedAt\":\"2024-05-18T03:50:00Z\",\"content\":\"(C)2024,Nikkan Sports News.\\r\\nnikkansports.comNEWS\"},{\"source\":{\"id\":null,\"name\":\"YouTube\"},\"author\":null,\"title\":\"【LIVE】最新気象・地震情報 2024年5月18日(土)／九州から北海道は晴れて暑いくらい 沖縄は梅雨入りか〈ウェザーニュースLiVEサンシャイン・青原 桃香〉 - ウェザーニュース\",\"description\":null,\"url\":\"https://www.youtube.com/watch?v=-XR0nCoJpqY\",\"urlToImage\":null,\"publishedAt\":\"2024-05-18T02:54:03Z\",\"content\":\"Your browser isnt supported anymore. Update it to get the best YouTube experience and our latest features. Learn more\\r\\nRemind me later\"},{\"source\":{\"id\":null,\"name\":\"Daily.co.jp\"},\"author\":\"デイリースポーツ online\",\"title\":\"「この写真ヤバい」衝撃 鈴木保奈美５７歳 ３０年揃わなかった大物女優３ショ 奇跡に騒然「凄いメンバー」「泣きそう」「感動」 - デイリースポーツ\",\"description\":\"女優鈴木保奈美（５７）が１８日、ＳＮＳにフジテレビで楽屋が並んだ女優たちと衝撃メンバーによる３ショを投稿した。　「『逃奔政走』の取材を受けるためフジテレビにやってきたら、隣の楽屋が有森也美様で、そのお隣が千堂あきほ様だった。なんということで...\",\"url\":\"https://www.daily.co.jp/gossip/2024/05/18/0017666386.shtml\",\"urlToImage\":\"https://i.daily.jp/gossip/2024/05/18/Images/f_17666387.jpg\",\"publishedAt\":\"2024-05-18T02:36:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Sankei.com\"},\"author\":\"産経新聞：産経ニュース\",\"title\":\"１キロ前から「意識なかった」 首都高３人死亡事故で男供述 - 産経ニュース\",\"description\":\"埼玉県戸田市の首都高速道路で車７台が絡み３人が死亡した事故で、自動車運転処罰法違反容疑で現行犯逮捕された運送会社社員、降籏紗京容疑者（２８）が、現場約１キロ手…\",\"url\":\"https://www.sankei.com/article/20240518-ZTFIMACOQJK3BIQYMLWFJ52KR4/\",\"urlToImage\":\"https://www.sankei.com/resizer/NhnSWxdadWNWIV6Fgd5pEDJ9g2o=/1200x630/smart/filters:quality(50)/cloudfront-ap-northeast-1.images.arcpublishing.com/sankei/BISJ2CNVFVMMXE5NELQ5CYEIFM.jpg\",\"publishedAt\":\"2024-05-18T02:26:46Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Nikkei.com\"},\"author\":\"日本経済新聞社\",\"title\":\"ガザ撮影の国連職員「心壊れる」 寒暖差襲うがれきの街 - 日本経済新聞\",\"description\":\"パレスチナ自治区ガザを訪問した国連パレスチナ難民救済事業機関（UNRWA）の清田明宏・保健局長が日本経済新聞の取材に応じ、映像とともに現地の惨状を語った。過去の滞在で見慣れた建物はことごとく破壊され「死の街のようだった」という。清田氏は3月下旬から約3週間、医療支援のためにガザを訪問した。ガザ南部ハンユニス近くのマワシ地区では、住民がビニールで手作りしたテントがひしめき合っていた。もともと無\",\"url\":\"https://www.nikkei.com/article/DGXZQOCB1676O0W4A510C2000000/\",\"urlToImage\":\"https://article-image-ix.nikkei.com/https%3A%2F%2Fimgix-proxy.n8s.jp%2FDSXZQO4847287017052024000000-1.jpg?ixlib=js-3.8.0&auto=format%2Ccompress&fit=crop&bg=FFFFFF&w=1200&h=630&fp-x=0.5&fp-y=0.5&fp-z=1&crop=focalpoint&s=0b7e2b6d9f4687530b00d617427381e9\",\"publishedAt\":\"2024-05-18T02:00:00Z\",\"content\":null},{\"source\":{\"id\":\"reuters\",\"name\":\"Reuters\"},\"author\":\"Liangping Gao, Clare Jim\",\"title\":\"アングル：中国の住宅買い換えキャンペーン、中古物件売れず苦戦 - ロイター (Reuters Japan)\",\"description\":\"中国当局は低迷する不動産市場のてこ入れ策として、市民に新しい住宅への買い換えを促すキャンペーンに乗り出し、関心も集まっている。しかし中古住宅の売れ行きが悪く、政策推進の大きな壁になっている。\",\"url\":\"https://jp.reuters.com/markets/world-indices/N7S6G5BJYBKNJDQ5QKKRDDIU6M-2024-05-18/\",\"urlToImage\":\"https://www.reuters.com/resizer/v2/HA4AGFKSAVL3BBLXOQSTFWELSE.jpg?auth=2dfd7fe2512a014224f9b2c576cf5cfba146c537ab528fc04b9b271cf5e66e38&height=1005&width=1920&quality=80&smart=true\",\"publishedAt\":\"2024-05-18T01:18:06Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Nhk.or.jp\"},\"author\":null,\"title\":\"北朝鮮“ミサイル発射実験 17日に実施 新誘導システム導入” | NHK | 北朝鮮 ミサイル - nhk.or.jp\",\"description\":\"北朝鮮は、戦術弾道ミサイルの発射実験を17日、日本海上で実施したと発表しました。ミサイルには、新たな誘導システムが導入さ…\",\"url\":\"https://www3.nhk.or.jp/news/html/20240518/k10014453111000.html\",\"urlToImage\":\"https://www3.nhk.or.jp/news/html/20240518/K10014453111_2405181004_0518100610_01_03.jpg\",\"publishedAt\":\"2024-05-18T01:01:26Z\",\"content\":\"17\"},{\"source\":{\"id\":null,\"name\":\"Yomiuri.co.jp\"},\"author\":\"読売新聞オンライン\",\"title\":\"イスラエル軍、ガザから人質３人の遺体収容…軍事作戦正当化の口実となる可能性も - 読売新聞オンライン\",\"description\":\"【エルサレム＝倉茂由美子】イスラエル軍は１７日、パレスチナ自治区ガザでイスラム主義組織ハマスが人質としていたイスラエル人３人の遺体を１６日夜に収容したと発表した。軍報道官は「人質を発見し、祖国に戻すまであらゆる手を尽く\",\"url\":\"https://www.yomiuri.co.jp/world/20240518-OYT1T50024/\",\"urlToImage\":\"https://www.yomiuri.co.jp/media/2024/05/20240518-OYT1I50026-1.jpg?type=ogp\",\"publishedAt\":\"2024-05-18T00:48:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Bloomberg.co.jp\"},\"author\":null,\"title\":\"日本製鉄、ＵＳスチール買収巡り働きかけ強化－労組や政治家を説得へ - ブルームバーグ\",\"description\":\"日本製鉄は労働組合幹部やバイデン政権からの厳しい反対にもかかわらず、141億ドル（約２兆1900億円）規模のＵＳスチール買収を実現させるため、米国の労働者や政治家への働きかけを強めている。\",\"url\":\"https://www.bloomberg.co.jp/news/articles/2024-05-17/SDNI1PT0G1KW00\",\"urlToImage\":\"https://assets.bwbx.io/images/users/iqjWHBFdfxIU/iM2I2hoNJXaM/v0/1200x800.jpg\",\"publishedAt\":\"2024-05-17T23:38:00Z\",\"content\":\"日本製鉄は労働組合幹部やバイデン政権からの厳しい反対にもかかわらず、141億ドル（約２兆1900億円）規模の\\r\\nＵＳスチール買収を\\r\\n実現させるため、米国の労働者や政治家への働きかけを強めている。\\r\\n　　日本製鉄は森高弘副社長をピッツバーグに近く派遣し、現地のスタッフや議員らと会談する予定だ。この問題について説明を受けた関係者が明らかにした。\\r\\n　　同社は労組幹部や米当局に買収のメリットを理解し… [+594 chars]\"},{\"source\":{\"id\":null,\"name\":\"Formula1-data.com\"},\"author\":\"AKAI Taro\",\"title\":\"F1イモラ：スタート練習違反の角田裕毅を処分、走行妨害疑惑のペレスは不問 - Formula1-Data\",\"description\":\"F1エミリア・ロマーニャGPのスチュワードは初日プラクティスを経て、角田裕毅（RBフォーミュラ1）を戒告処分とし、また、セルジオ・ペレス（レッドブル）については\",\"url\":\"https://formula1-data.com/article/f1-emilia-romagna-tsunoda-penalized-for-start-violation-perez-not-penalized\",\"urlToImage\":\"https://formula1-data.com/assets/img/uploads/2024/05/emilia-romagna-day2-tsunoda-2024-1.jpg\",\"publishedAt\":\"2024-05-17T23:16:14Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Tenki.jp\"},\"author\":\"戸田　よしか\",\"title\":\"土日の天気 18日は晴れて暑い 北海道で夏日も 19日は関東以西で雨の所が増える(気象予報士 戸田 よしか 2024年05月18日) - tenki.jp\",\"description\":\"今日18日(土)は、ほぼ全国で晴れ。本州の内陸を中心に真夏日の所があり、札幌をはじめ北海道で夏日も。明日19日(日)も多くの所で晴れて暑さが続くが、関東以西は太平洋側ほど雨雲がかかりやすくなる。\",\"url\":\"https://tenki.jp/forecaster/yosh_ika/2024/05/18/28793.html\",\"urlToImage\":\"https://storage.tenki.jp/storage/static-images/forecaster_diary/image/2/28/287/28793/main/20240518075502/large.jpg\",\"publishedAt\":\"2024-05-17T22:59:32Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Nikkei.com\"},\"author\":\"日本経済新聞社\",\"title\":\"ＮＹダウ4万ドル 米市場関係者「割高もバブルにあらず」 - 日本経済新聞\",\"description\":\"17日の米株式市場でダウ工業株30種平均が4万ドルの大台を突破した。米株相場の強さの背景や先行きについて、米市場関係者に聞いた。米株高、テック一極集中は長続きせず米資産運用会社ファースト・イーグル・インベストメンツのグローバル・バリュー投資部門責任者、キンボール・ブルッカー氏米株高はインフレが落ち着く一方、労働市場は堅調で景気は軟着陸できるとの市場の期待が背景にある。米連邦準備理事会（FR\",\"url\":\"https://www.nikkei.com/article/DGXZQOGN21DM70R20C24A3000000/\",\"urlToImage\":\"https://article-image-ix.nikkei.com/https%3A%2F%2Fimgix-proxy.n8s.jp%2FDSXZQO4659032001042024000000-1.jpg?ixlib=js-3.8.0&auto=format%2Ccompress&fit=crop&bg=FFFFFF&w=1200&h=630&fp-x=0.51&fp-y=0.37&fp-z=1&crop=focalpoint&s=a378d7b9b1ddc54bea7d05973334b0cb\",\"publishedAt\":\"2024-05-17T21:48:18Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Nhk.or.jp\"},\"author\":null,\"title\":\"アメリカ政府 臨界前核実験を実施と発表 バイデン政権で3回目 | NHK - nhk.or.jp\",\"description\":\"アメリカ政府は、核爆発を伴わない臨界前核実験を5月14日に行ったと発表しました。バイデン政権下で実施が確認された臨界前核…\",\"url\":\"https://www3.nhk.or.jp/news/html/20240518/k10014453061000.html\",\"urlToImage\":\"https://www3.nhk.or.jp/news/html/20240518/K10014453061_2405180511_0518062647_01_03.jpg\",\"publishedAt\":\"2024-05-17T21:26:45Z\",\"content\":\"5143\\r\\nNNSA514\\r\\n3202193\\r\\n199234\\r\\nCTBTNNSACTBT\\r\\nNNSA\"},{\"source\":{\"id\":null,\"name\":\"Tokyo-np.co.jp\"},\"author\":\"東京新聞 TOKYO Web\",\"title\":\"自民党がフリーなカネ「政策活動費」温存に一生懸命 独自の政治資金規正法改正案を提出 しっかり穴だらけ：東京新聞 TOKYO Web - 東京新聞\",\"description\":\"自民党は17日、派閥の政治資金パーティー裏金事件を受けた政治資金規正法改正案を衆院に単独で提出した。焦点の一つである政策活動費の使途公...\",\"url\":\"https://www.tokyo-np.co.jp/article/327775\",\"urlToImage\":\"https://static.tokyo-np.co.jp/image/article/size1/4/8/8/b/488b82625f993a9fef6c20f6fa572e16_1.jpg\",\"publishedAt\":\"2024-05-17T21:00:00Z\",\"content\":null}]}"
            listener.callback(response)
        }
    }
}