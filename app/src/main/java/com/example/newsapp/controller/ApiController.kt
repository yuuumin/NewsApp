package com.example.newsapp.controller

import java.io.BufferedReader
import java.io.IOException
import java.io.InputStream
import java.io.InputStreamReader
import java.net.HttpURLConnection
import java.net.URL


class ApiController {

    val TIMEOUT_MILLIS = 0

    interface ICallback {
        fun callback(result: String)
    }

    fun get(listener: ICallback, endpoint: String, headers: Map<String, String>, params: Map<String, String>?) {

        val sb: StringBuffer = StringBuffer("")
        var httpConn: HttpURLConnection? = null
        var br: BufferedReader? = null
        var `is`: InputStream? = null
        var isr: InputStreamReader? = null

        try {
            val url = URL(endpoint)
            httpConn = url.openConnection() as HttpURLConnection
            httpConn.connectTimeout = TIMEOUT_MILLIS // 接続にかかる時間
            httpConn.readTimeout = TIMEOUT_MILLIS // データの読み込みにかかる時間
            httpConn.requestMethod = "GET" // HTTPメソッド
            httpConn.useCaches = false // キャッシュ利用
            httpConn.doOutput = false // リクエストのボディの送信を許可(GETのときはfalse,POSTのときはtrueにする)
            httpConn.doInput = true // レスポンスのボディの受信を許可

            httpConn.connect()

            val responseCode = httpConn.responseCode

            if (responseCode == HttpURLConnection.HTTP_OK) {
                `is` = httpConn.inputStream
                isr = InputStreamReader(`is`, "UTF-8")
                br = BufferedReader(isr)
                var line: String? = null
                while (br.readLine().also { line = it } != null) {
                    sb.append(line)
                }
            } else {
                // TODO: OKじゃない時のことを考える
                // TODO: 結果をどこまで戻してどこで判定するか？
                // 403
                // 500
            }
        } catch (e: IOException) {
            throw e
        } finally {
//            Callback.callback(sb.toString())

            val response = "{\"status\":\"ok\",\"totalResults\":30,\"articles\":[{\"source\":{\"id\":null,\"name\":\"Iwate-np.co.jp\"},\"author\":null,\"title\":\"自民「１０万円超」公明に提示へ - 岩手日報\",\"description\":\"自民党は１５日、派閥の政治資金パーティー裏金事件を受けた政治資金規正法改正の条文案に、政治資金パーティー券購入者の公開基準額を現行の「２０万円超」から「１０万円超」への引き下げを明記する方向で調整に入った。同日午後、公明党に提示する。公明は…\",\"url\":\"https://www.iwate-np.co.jp/article/kyodo/2024/5/15/1311046\",\"urlToImage\":\"https://www.iwate-np.co.jp/media/static/kyodo/photo/736693/d3b35df1qm0kZwNjWzt9AwZjWzL9L292MKVgqT9jWy89AwL0AQVjMQH.jpg\",\"publishedAt\":\"2024-05-15T02:39:21Z\",\"content\":null},{\"source\":{\"id\":\"reuters\",\"name\":\"Reuters\"},\"author\":\"ロイター編集\",\"title\":\"インフレなお高水準、まだやることある＝カンザスシティー連銀総裁 - ロイター (Reuters Japan)\",\"description\":\"米カンザスシティー地区連銀のシュミッド総裁は１４日、米インフレ率は依然高水準で、米連邦準備理事会（ＦＲＢ）はまだやるべきことがあると述べた。\",\"url\":\"https://jp.reuters.com/economy/federal-reserve-board/FLTCK5UHMJNRNJI6WQF664VTUA-2024-05-15/\",\"urlToImage\":\"https://www.reuters.com/resizer/v2/L2REHXLJCFJOZKOFSYYO7O3FII.jpg?auth=d2cdb3374e14276f447dd1b1e4030641fb92b7f27a9c79ccabaf2707f90da70d&height=1005&width=1920&quality=80&smart=true\",\"publishedAt\":\"2024-05-15T02:17:17Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Powerwatch.jp\"},\"author\":\"masatsunetsu@ymail.ne.jp\",\"title\":\"【セイコー“クレドール”50周年記念作】限定5本のみ黄綬褒章受章者の技術を注ぎ込んだ希少モデル - ウオッチライフニュース\",\"description\":\"セイコーは、1974年に誕生した日本発の高級ドレスウオッチブランド“クレドール”の50周年を記念して、薄型メカニカルウオッチの系譜を脈々と受け継ぐ“ゴールドフェザー”の限定モデルを発表。世界限定5本を\",\"url\":\"https://www.powerwatch.jp/2024/05/15/seiko-105/\",\"urlToImage\":\"https://www.powerwatch.jp/wp496/wp-content/uploads/2024/05/wln_0514_01_0m.jpg\",\"publishedAt\":\"2024-05-15T02:10:58Z\",\"content\":\"FURLAFURLA MULTI TRAVEL 118 ...\"},{\"source\":{\"id\":null,\"name\":\"4gamer.net\"},\"author\":\"鐃峻緒申鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申\",\"title\":\"ゲーマー向けスマホ「ROG Phone 8」が国内発売。防水防塵やおサイフケータイ対応で普段使いしやすい製品に - 4Gamer.net\",\"description\":\"2024年5鐃緒申15鐃緒申鐃緒申ASUS鐃熟￥申鐃緒申鐃緒申鐃殉￥申鐃緒申鐃緒申鐃緒申鐃殉￥申鐃夙フワ申鐃緒申鐃怊OG Phone 8鐃竣ワ申鐃所ー鐃緒申鐃緒申5鐃緒申17鐃緒申鐃緒申発鐃巡す鐃緒申鐃夙・緒申鐃緒申鐃粛緒申鐃塾種申鐃春を開始わ申鐃緒申鐃緒申鐃盾い鐃緒申鐃准ッワ申鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申如鐃忭P68鐃緒申鐃緒申鐃宿随申鐃宿水機能鐃巡お鐃緒申鐃緒申鐃春ワ申鐃緒申鐃緒申鐃緒申鐃舜わ申鐃出縁申鐃淑ど￥申鐃緒申鐃緒申鐃緒申鐃緒申鐃俊以鰹申鐃緒申鐃緒申分鐃薯強駕申鐃緒申鐃緒申鐃塾わ申鐃緒申鐃宿わ…\",\"url\":\"https://www.4gamer.net/games/047/G004755/20240514058/\",\"urlToImage\":\"https://www.4gamer.net/games/047/G004755/20240514058/SS/001.jpg\",\"publishedAt\":\"2024-05-15T02:00:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Nikkansports.com\"},\"author\":\"日刊スポーツ\",\"title\":\"大谷翔平12号！日本人最多更新25球場目 敵地ジャイアンツ戦 スプラッシュはならず／速報中 - ＭＬＢ - ニッカンスポーツ\",\"description\":\"ドジャース大谷翔平投手は「2番DH」で先発出場。右翼場外のサンフランシスコ湾に飛び込むスプラッシュヒットは出るか。相手先発はメジャー2年目の右腕キートン・ウィ… - 日刊スポーツ新聞社のニュースサイト、ニッカンスポーツ・コム（nikkansports.com）。\",\"url\":\"https://www.nikkansports.com/baseball/mlb/news/202405140000661.html\",\"urlToImage\":\"https://www.nikkansports.com/baseball/mlb/news/img/202405140000661-w500_0.jpg\",\"publishedAt\":\"2024-05-15T01:51:00Z\",\"content\":\"(C)2024,Nikkan Sports News.\\r\\nnikkansports.comNEWS\"},{\"source\":{\"id\":null,\"name\":\"Nhk.or.jp\"},\"author\":null,\"title\":\"島根原発2号機 仮処分申し立て退ける決定 広島高裁松江支部 | NHK - nhk.or.jp\",\"description\":\"再稼働に向けた準備が進む、松江市の島根原子力発電所2号機について広島高等裁判所松江支部は、地元の住民が地震や火山の噴火な…\",\"url\":\"https://www3.nhk.or.jp/news/html/20240515/k10014449471000.html\",\"urlToImage\":\"https://www3.nhk.or.jp/news/html/20240515/K10014449471_2405150955_0515095530_01_02.jpg\",\"publishedAt\":\"2024-05-15T01:24:26Z\",\"content\":\"\"},{\"source\":{\"id\":null,\"name\":\"Yomiuri.co.jp\"},\"author\":\"読売新聞オンライン\",\"title\":\"カンヌ映画祭開幕、審査員の是枝裕和監督も登壇…ジブリに「名誉パルムドール」授与へ - 読売新聞オンライン\",\"description\":\"【カンヌ＝松田拓也】南仏カンヌで１４日夜（現地時間）、第７７回カンヌ国際映画祭の開幕式が行われ、仏のカンタン・デュピュー監督の「ザ・セカンド・アクト」（英題）がオープニング作品として上映された。２２作品が最高賞パルムド\",\"url\":\"https://www.yomiuri.co.jp/culture/cinema/20240515-OYT1T50048/\",\"urlToImage\":\"https://www.yomiuri.co.jp/media/2024/05/20240515-OYT1I50052-1.jpg?type=ogp\",\"publishedAt\":\"2024-05-15T01:03:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Sankei.com\"},\"author\":\"大内 清\",\"title\":\"米大統領選共和ランニングメート候補ら忠誠競う トランプ裁判は「オーディション」の様相 - 産経ニュース\",\"description\":\"【ワシントン＝大内清】米東部ニューヨーク州で進むトランプ前大統領（共和党）の刑事裁判に共和党の有力者らが相次いで応援に駆けつけ、トランプ氏への忠誠心を競い合っ…\",\"url\":\"https://www.sankei.com/article/20240515-M3ZWQ7ABSZL5PAKQWK7BTP2GMA/\",\"urlToImage\":\"https://www.sankei.com/resizer/8Kf-xJU1-pDHxZv_Tmc6nwQZSRo=/1200x630/smart/filters:quality(50)/cloudfront-ap-northeast-1.images.arcpublishing.com/sankei/GNFLJV2VIJI3BHMPKEGV6AUK3U.jpg\",\"publishedAt\":\"2024-05-15T00:50:37Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Tenki.jp\"},\"author\":\"吉田　友海\",\"title\":\"16日 西・東日本で落雷・突風・強雨に注意 寒冷渦で大気の状態が非常に不安定(気象予報士 吉田 友海 2024年05月15日) - tenki.jp\",\"description\":\"明日16日(木)は寒冷渦(上空に寒気を伴った低気圧)の影響で、大気の状態が非常に不安定になるでしょう。西日本や東日本は落雷、竜巻などの激しい突風、ひょう、急な強い雨にご注意ください。\",\"url\":\"https://tenki.jp/forecaster/t_yoshida/2024/05/15/28756.html\",\"urlToImage\":\"https://storage.tenki.jp/storage/static-images/forecaster_diary/image/2/28/287/28756/main/20240515090210/large.jpg\",\"publishedAt\":\"2024-05-15T00:23:15Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Oricon.co.jp\"},\"author\":null,\"title\":\"『虎に翼』花岡の“婚約者”が判明 元SKE48登場にネット驚き「まさか」「相変わらず美人だな～」 - ORICON NEWS\",\"description\":null,\"url\":\"https://www.oricon.co.jp/news/2327077/full/\",\"urlToImage\":null,\"publishedAt\":\"2024-05-14T23:15:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Nikkei.com\"},\"author\":\"日本経済新聞社\",\"title\":\"早稲田大学の入試で不正、スマートグラス悪用 受験生を書類送検へ - 日本経済新聞\",\"description\":\"今年2月にあった早稲田大（東京都新宿区）の一般入試で、眼鏡型の情報通信端末「スマートグラス」で問題が撮影され、試験時間中にSNSを通じ流出していたことが15日、捜査関係者への取材で分かった。警視庁は問題を不正に流出させたとして、都内在住の男子受験生（18）を偽計業務妨害容疑で近く書類送検する方針。捜査関係者によると、男子受験生は早大の入試で、カメラ・通信機能があるスマートグラスで問題を撮影。手\",\"url\":\"https://www.nikkei.com/article/DGXZQOUE1509P0V10C24A5000000/\",\"urlToImage\":\"https://article-image-ix.nikkei.com/https%3A%2F%2Fimgix-proxy.n8s.jp%2FDSXZQO4833145015052024000000-1.jpg?ixlib=js-3.8.0&auto=format%2Ccompress&fit=crop&bg=FFFFFF&w=1200&h=630&fp-x=0.81&fp-y=0.85&fp-z=1&crop=focalpoint&s=43bbf0b4f8a1c70d0c9f01419fc220ac\",\"publishedAt\":\"2024-05-14T22:29:42Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Jiji.com\"},\"author\":\"時事通信社, 時事通信 社会部\",\"title\":\"火星の有機物、ＣＯが起源 ３０億年前、大気中から―東工大など：時事ドットコム - 時事通信ニュース\",\"description\":\"米航空宇宙局（ＮＡＳＡ）の火星探査車による掘削調査で約３０億年前の火星の堆積物から見つかった有機物は、大気中にあった一酸化炭素（ＣＯ）から生成されたことを東京工業大などの研究チームが突き止めた。初期の地球でも同様の仕組みが考えられるといい、生命の起源を解き明かす手掛かりになると期待される。論文は１４日までに、英科学誌ネイチャー・ジオサイエンスに掲載された。\",\"url\":\"https://www.jiji.com/jc/article?k=2024051401090&g=soc\",\"urlToImage\":\"https://www.jiji.com/news2/kiji_photos/202405/20240514at71S_ogp.jpg\",\"publishedAt\":\"2024-05-14T22:08:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"YouTube\"},\"author\":null,\"title\":\"【水原一平被告が無罪主張】後日認める見通し 大谷選手の口座から不正送金か - 日テレNEWS\",\"description\":\"ドジャース大谷翔平選手の元通訳・水原一平被告が、大谷選手の口座から不正に送金したとされる事件の裁判で、水原被告は14日、法廷で無罪を主張しました。この動画の記事を読む＞https://news.ntv.co.jp/category/international/ed418a961d2b4aa8927f611f06e...\",\"url\":\"https://www.youtube.com/watch?v=K-kDGQzUBTo\",\"urlToImage\":\"https://i.ytimg.com/vi/K-kDGQzUBTo/hqdefault.jpg\",\"publishedAt\":\"2024-05-14T21:45:59Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Www.fnn.jp\"},\"author\":\"フジテレビ, 国際取材部\",\"title\":\"アメリカ・ブリンケン国務長官がウクライナ電撃訪問「あなたは一人ではない」ロシアとの戦闘激化も「支持揺るがず」｜FNNプライムオンライン - FNNプライムオンライン\",\"description\":\"アメリカのブリンケン国務長官は14日、ロシアの軍事侵攻を受けるウクライナの首都キーウを電撃訪問し、ゼレンスキー大統領らに対し揺るぎない支持を表明した。ブリンケン国務長官「メッセージとともにウクライナに来た。あなたたちは1人ではない」ブリンケン氏はキーウで演説し、一時滞っていたアメリカ政府の軍事支援が再開されたことを指摘し、「ウクライナへの支持は決して揺らぐことはない」と強調した。これに先立ちブリンケン氏は、ゼレンスキー大統領らと会談し、「アメリカの追加軍事支援が戦場の状況を改善するだろう」と語った。一方、ゼレンス…\",\"url\":\"https://www.fnn.jp/articles/-/699298\",\"urlToImage\":\"https://fnn.ismcdn.jp/mwimgs/0/d/600/img_0dc8b2b6047c70c2f1696680c6ebb23b580915.jpg\",\"publishedAt\":\"2024-05-14T21:30:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Tv-asahi.co.jp\"},\"author\":\"テレ朝news\",\"title\":\"【独自】栃木・夫婦焼損遺体事件 再逮捕の男 “指示役”から出頭を促されたか[2024/05/15 06:20] - テレビ朝日\",\"description\":\"栃木県那須町で夫婦の遺体が見つかった事件で、自ら出頭して逮捕された男が、指示役から出頭を促されていたという趣旨の話をしていることが分かりました。\\n\\n　平山綾拳容疑者（25）は、仲間と共謀して宝島龍太郎さん（55）と妻の幸子さん（56）を殺害した疑いが持たれています。\\n\\n　平山容疑者は遺体が発見された翌日に出頭しましたが、その後の捜査関係者への取材で、平山容疑者が出頭理由について、指示役とみられる佐々木光容疑者から「『依頼主（関根容疑者）が平山に出頭させられないかと言っている』と言われた」と説明していることが分かり…\",\"url\":\"https://news.tv-asahi.co.jp/news_society/articles/000349426.html\",\"urlToImage\":\"https://news.tv-asahi.co.jp/articles_img/000349426_1920.jpg\",\"publishedAt\":\"2024-05-14T21:20:43Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Www.fnn.jp\"},\"author\":\"フジテレビ, 社会部\",\"title\":\"通行止めようやく解除…首都高美女木ジャンクションの7台多重事故で4台炎上し3人死亡｜FNNプライムオンライン - FNNプライムオンライン\",\"description\":\"埼玉・戸田市の首都高速で14日、トラックが渋滞の列に突っ込み、3人が死亡した。トラック運転手は「ぶつかった時に意識はなかった」と供述している。14日午前7時半ごろ、戸田市の首都高・5号池袋線下り・美女木ジャンクション付近で、トラックが渋滞の列に突っ込み、7台がからむ玉突き事故となった。追突された3台の乗用車が炎上し、乗っていた3人が死亡したほか、2人がけがをした。警視庁は、追突したトラックの運転手・降籏紗京容疑者（28）を過失運転致死の現行犯で逮捕した。降籏容疑者は、「ぶつかった時に意識はありませんでした」と供述…\",\"url\":\"https://www.fnn.jp/articles/-/699294\",\"urlToImage\":\"https://fnn.ismcdn.jp/mwimgs/5/4/600/img_5403afc6904337561fe3c602c52c2072374070.jpg\",\"publishedAt\":\"2024-05-14T21:18:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Chunichi.co.jp\"},\"author\":\"中日スポーツ・東京中日スポーツ\",\"title\":\"オークスで父ゴールドシップの評価さらに高められるか…ビッグレッドファームの申し子コガネノソラに期待【村本浩平コラム】：中日スポーツ・東京中日スポーツ - 中日新聞\",\"description\":\"◇競馬コラム「馬産地インサイ道」　スイートピーSを優勝し、今週のオークスへと挑むコガネノソラ（牝3歳、美浦・菊沢）は、北海道新冠町・ビ...\",\"url\":\"https://www.chunichi.co.jp/article/898599\",\"urlToImage\":\"https://static.chunichi.co.jp/image/article/size1/c/c/6/b/cc6b258a9a8e6c161e1234a2872ad5c5_1.jpg\",\"publishedAt\":\"2024-05-14T21:00:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Nhk.or.jp\"},\"author\":null,\"title\":\"【随時更新】ロシア ウクライナに軍事侵攻（5月15日の動き） | NHK - nhk.or.jp\",\"description\":\"ロシアによるウクライナに対する軍事侵攻が続いています。ウクライナの各地でロシア軍とウクライナ軍が戦闘を続けていて、大勢の…\",\"url\":\"https://www3.nhk.or.jp/news/html/20240515/k10014406761000.html\",\"urlToImage\":\"https://www3.nhk.or.jp/news/html/20240515/K10014406761_2403291645_0427074825_01_02.jpg\",\"publishedAt\":\"2024-05-14T20:39:53Z\",\"content\":\"15\\r\\n6\\r\\n 514\\r\\n- NHK\\r\\nNATO\\r\\nNATONATO7NATO\\r\\nNATONATO\\r\\n14NATONATO\\r\\nNATO\\r\\n7NATO420287\\r\\nNATO\"},{\"source\":{\"id\":null,\"name\":\"Sankei.com\"},\"author\":\"産経新聞：産経ニュース\",\"title\":\"つばさの党、選挙カー追跡 「交通の便妨げる行為」適用も視野に捜査 警視庁 - 産経ニュース\",\"description\":\"４月の衆院東京１５区補欠選挙を巡る自由妨害疑惑を巡り、出馬していた複数の陣営の選挙カーが、政治団体「つばさの党」の選挙カーから執拗（しつよう）な追跡を受け、警…\",\"url\":\"https://www.sankei.com/article/20240515-2U5ND6S2PZIUXGCP7G754VREBM/\",\"urlToImage\":\"https://www.sankei.com/resizer/n5ewgSK7v0PBIHdYy5PNoT-4L9U=/1200x630/smart/filters:quality(50)/cloudfront-ap-northeast-1.images.arcpublishing.com/sankei/K7WF2E7JQ5KQ7INGWW5K5WI66Q.jpg\",\"publishedAt\":\"2024-05-14T20:00:00Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"Natalie.mu\"},\"author\":\"音楽ナタリー編集部\",\"title\":\"スト、なにわ、トラジャ、ハイハイのスポーツ自慢が「ジョンソン」芸人軍と対決（写真5枚） - 音楽ナタリー\",\"description\":\"SixTONESのジェシー、高地優吾、田中樹、なにわ男子の高橋恭平、Travis Japanの中村海人と松倉海斗、HiHi Jetsの井上瑞稀と猪狩蒼弥が5月20日21:00よりTBS系で放送される「ジョンソン」スペシャルに出演する。\",\"url\":\"https://natalie.mu/music/news/573343\",\"urlToImage\":\"https://ogre.natalie.mu/media/news/music/2024/0514/johnson_01.jpg?impolicy=twitter_card_face_crop\",\"publishedAt\":\"2024-05-14T20:00:00Z\",\"content\":\"ATEEZLE SSERAFIMSHINeeEXO\"}]}"
            listener.callback(response)
        }
    }
}